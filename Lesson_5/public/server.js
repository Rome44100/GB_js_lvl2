(()=>{"use strict";var t={196:()=>{window.addEventListener("scroll",(function(){pageYOffset<document.documentElement.clientHeight?(document.querySelector("#triton_up").style.opacity="0",document.querySelector("#triton_up").style.visibility="hidden"):(document.querySelector("#triton_up").style.opacity=".4",document.querySelector("#triton_up").style.visibility="visible")})),document.getElementById("triton_up").addEventListener("click",(function(t){t.preventDefault(),document.getElementById("top").scrollIntoView({behavior:"smooth",block:"start"})}))}},e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={exports:{}};return t[i](s,s.exports,n),s.exports}(()=>{function t(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n(196);class e{constructor(e,n){t(this,"_text",""),t(this,"_callback",null),t(this,"_id",null),t(this,"_placeToRender",null),this._text=e,this._callback=n,this._id=Date.now()+Math.round(1e5*Math.random())}onBtnClick(){const t=this._callback;"function"==typeof t&&t()}getTemplate(){const t=document.createElement("button");return t.classList.add("btn"),t.id=this._id,t}render(t){if(t){this._placeToRender=t;const e=this.getTemplate();e.innerHTML=this._text,t.appendChild(e),e.addEventListener("click",(()=>{this.onBtnClick()}))}}destroy(){const t=this._placeToRender.querySelector(`[id = "${this._id}"]`);t.parentNode.removeChild(t)}}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}new e("My button"),new class extends e{constructor(t){super(t)}onBtnClick(){alert("Was clicked!")}}("My button");class s{constructor({name:t,price:e,img:n},s){i(this,"_name",""),i(this,"_price",""),i(this,"_img",""),i(this,"_cartInstance",null),this._name=t,this._price=e,this._img=n,this._cartInstance=s}addToCart(){this._cartInstance.add(this)}render(){const t=document.querySelector(".products_wrap");if(t){const e=document.createElement("div");e.classList.add("one_product"),e.innerHTML=`<div class="one_prod_img">\n                    <a href="detail.html">\n                        <img src="${this._img}" alt="${this._name}" loading="lazy">\n                    </a>\n                </div>\n                <div class="one_prod_title">\n                    <h3>\n                        <a href="detail.html">${this._name}</a>\n                    </h3>\n                </div>\n                <div class="product_buy">\n                    <div class="price_wrap">\n                        <div class="price">\n                            <span class="pre_title">от</span>\n                            <span class="price_value">${this._price}</span>\n                            <span class="price_currency">руб.</span>\n                        </div>\n                        <div class="product_buy_button">\n                            \x3c!-- RENDER BUTTON BUY --\x3e\n                        </div>\n                    </div>\n                </div>`,t.appendChild(e),this.addButton(e)}}addButton(t){const n=t.querySelector(".product_buy_button");n&&new e("Купить",this.addToCart.bind(this)).render(n)}}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class c{constructor({_name:t,_price:e,_img:n,obj:i,_cnt:s}){r(this,"_name",""),r(this,"_price",""),r(this,"_img",""),r(this,"_obj",null),r(this,"_cnt",1),this._name=t,this._price=e,this._img=n,this._obj=i,this._cnt=s}render(){const t=document.createElement("div");return t.innerHTML=`<div style="clear:both;">\n            <img style="width: 50px; float: left;" src="${this._img}" alt="${this._name}">\n            <span>${this._name}</span>\n            <span>${this._price}</span>\n            <input type="number" value="${this._cnt}" style="width: 40px;">\n            <a href="#0">Х</a>\n        </div>`,t}}class a{constructor(){var t,e;e=[],(t="_items")in this?Object.defineProperty(this,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):this[t]=e}render(){}}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const d=new class extends a{constructor(...t){super(...t),o(this,"_names",[]),o(this,"_total_cnt",0),o(this,"_basket_price",0)}add(t){this._items.length&&this._names.includes(t._name)?this._items.find((e=>{if(t._name===e._name)return e}))._cnt++:(t._cnt=1,this._items.push(t),this._names.push(t._name)),this._total_cnt++,this._basket_price+=t._price,this.convertToObj(),this.render(t)}convertToObj(){let t=null;t=this._items.map((t=>new c(t))),this._items=t}render(){let t=document.querySelector(".basket_list");if(t){t.innerHTML="",t.style.display="block";const e=document.createElement("div");e.style.clear="both",e.innerHTML=`<hr>Всего товаров в корзине: <span id="total_cnt">${this._total_cnt}</span>`,t.insertAdjacentElement("beforeend",e);const n=document.createElement("div");n.innerHTML=`<hr>Общая стоимость всей корзины: <span id="basket_price">${this._basket_price}</span>`,t.insertAdjacentElement("beforeend",n),this._items.map(((e,n,i)=>{const s=e.render();t.insertAdjacentElement("afterbegin",s);const r=s.querySelector("input");r.addEventListener("change",(t=>{t.target.value=t.target.value>0?t.target.value:1,e._cnt<t.target.value?(this._total_cnt++,this._basket_price+=e._price):(this._total_cnt--,this._basket_price-=e._price),document.getElementById("total_cnt").innerText=this._total_cnt,document.getElementById("basket_price").innerText=this._basket_price,e._cnt=t.target.value})),r.addEventListener("keyup",(function(t){t.target.value=t.target.value>0?t.target.value:1,e._cnt<t.target.value?(this._total_cnt++,this._basket_price+=e._price):(this._total_cnt--,this._basket_price-=e._price),document.getElementById("total_cnt").innerText=this._total_cnt,document.getElementById("basket_price").innerText=this._basket_price,e._cnt=t.target.value})),s.querySelector("a").addEventListener("click",(t=>{this._total_cnt-=e._cnt,this._basket_price-=e._price*e._cnt,document.getElementById("total_cnt").innerText=this._total_cnt,document.getElementById("basket_price").innerText=this._basket_price,i.splice(n,1),this._names.splice(n,1),t.target.parentNode.parentNode.remove()}))}))}}changeCount(t,e){const n=document.querySelector("total_cnt"),i=document.querySelector("basket_price");n.innerHTML=this._total_cnt,i.innerHTML=this._basket_price}};new class extends a{constructor(t){super(),l(this,"_elemsAddCnt",1),l(this,"_url",`${document.location.protocol}//${document.location.host}/database/items.json`),l(this,"_cartInstance",null),this._cartInstance=t,this.addElems(this._url)}fetchGoods(){return fetch(this._url)}render(){this._items.forEach((t=>{t.render()}));const t=document.querySelector(".products_wrap");if(this._url=`${document.location.protocol}//${document.location.host}/database/items${this._elemsAddCnt}.json`,t){const n=new e("Еще товары",(()=>{this.addElems(this._url,n),this._elemsAddCnt++}));this._elemsAddCnt<3&&n.render(t)}}addElems(t,e=null){fetch(t).then((t=>t.json())).then((t=>{const e=t.data.map((t=>new s(t,this._cartInstance)));return this._items=e,this._items})).then((()=>{null!=e&&e.destroy()})).then(this.render.bind(this))}}(d)})()})();